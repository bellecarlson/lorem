/*! updated; 02-27-2018 04:46 PM **/


Modulr.define("core.plugins:MultiFeedParser",["jquery"],function($){var CONST={logName:"[Feed Parser]",jsonpParam:"callback",minRefreshRate:.3},App=function(config){config=config||{};var self=this;self.__vars={};var v=self.__vars;v._config=config,v._fn={},v._data={},v._xhr={},v._callStack={},v._initExe={},v._refreshObj={},self.event=new Events(self),v._fn.log=v._config.logging?log:function(){};var i,initOnLoad=!("boolean"==typeof v._config.initOnLoad&&!v._config.initOnLoad),feeds=!(!v._config||!v._config.feeds)&&v._config.feeds;if(initOnLoad&&feeds)for(i in feeds)loadFeed(v,i),feeds[i].refresh&&setRefreshRate(self,i,feeds[i])},Events=function(){var Event=function(root){this.__vars={},this.__vars.root=root};return Event.prototype.reload=function(types){var i,x,self=this,root=self.__vars.root,v=root.__vars,feeds=!(!v._config||!v._config.feeds)&&v._config.feeds,arr=[];if(!feeds)return!1;var setRefresh=function(type){v._refreshObj[type]||setRefreshRate(root,type,feeds[type])};if("string"==typeof types&&(types=trimStr(types).replace(/\s+/g," "),arr=types.split(" ")),arr.length>0)for(x=0;x<arr.length;x++)feeds[arr[x]]&&(v._fn.log(CONST.logName+" Reloading {type}: '"+arr[x]+"'"),loadFeed(v,arr[x]),setRefresh(arr[x]),!0);else{v._fn.log(CONST.logName+" Reloading all feed {type}");for(i in feeds)loadFeed(v,i),setRefresh(i);!0}},Event.prototype.addFeed=function(){var self=this,root=self.__vars.root,v=root.__vars,feeds=v._config&&v._config.feeds?v._config.feeds:{},args=arguments,config={type:!1,url:!1};if("string"==typeof args[0]&&"string"==typeof args[1]?(config.type=args[0],config.url=args[1]):"object"==typeof args[0]&&args[0].type&&args[0].url&&(config=args[0]),!config.type||!config.url)return v._fn.log(CONST.logName+" Cannot fire event.addFeed(). Missing config {type} or {url}."),!1;if(feeds[config.type])return v._fn.log(CONST.logName+" Cannot fire event.addFeed() for {type}: '"+config.type+"'. This type already exists."),!1;var i,cfg={};for(i in config)"type"!==i&&(cfg[i]=config[i]);root.__vars._config.feeds||(root.__vars._config.feeds={}),root.__vars._config.feeds[config.type]=cfg,loadFeed(v,config.type),config.refresh&&setRefreshRate(root,config.type,cfg)},Event.prototype.removeFeed=function(type){var self=this,root=self.__vars.root;root.__vars;if(!root.__vars._config||!root.__vars._config.feeds||"string"!=typeof type)return!1;type=trimStr(type).replace(/\s+/g," ");type.split(" ")},Event.prototype.onLoad=function(){var self=this,root=self.__vars.root,v=root.__vars,feeds=v._config&&v._config.feeds?v._config.feeds:{},args=setLoaderArgs(arguments);if(!args.type||!args.callback||!feeds[args.type])return!1;var type=args.type,callback=args.callback;v._callStack[type]||(v._callStack[type]=[]),v._callStack[type].push(callback),v._initExe[type]&&callback(v._data[type])},Event.prototype.getData=function(){var self=this,root=self.__vars.root,v=root.__vars,args=(v._config&&v._config.feeds&&v._config.feeds,setLoaderArgs(arguments));if(!args.type||!args.callback)return!1;var timeoutObj,type=args.type,callback=args.callback,cntr=0,attempt=function(){void 0!==v._data[type]?callback(v._data[type]):cntr<=120&&(clearTimeout(timeoutObj),timeoutObj=setTimeout(function(){attempt()},250),cntr++)};attempt()},Event}(),setRefreshRate=function(self,type,info){if(!isNaN(info.refresh)){var config=self.__vars._config,refresh=!1;if(config.ignoreMinRefreshRate?refresh=info.refresh.toFixed(2):parseFloat(info.refresh)>=CONST.minRefreshRate&&(refresh=info.refresh.toFixed(2)),!refresh)return log(CONST.logName+" Warning: Cannot set refresh for {type}: '"+type+"' refresh rate less than minimum rate allowed."),!1;refresh*=6e4,clearInterval(self.__vars._refreshObj[type]),self.__vars._refreshObj[type]=setInterval(function(){self.event&&"function"==typeof self.event.reload?self.event.reload(type):log(CONST.logName+" Warning: Cannot find event.reload(). Reload for {type}: '"+type+"' not fired.")},refresh)}},loadFeed=function(vars,type){function commonSuccessFN(data){var normFN=getNormalizationFN(info.normalize,feeds),normalized=normFN?normFN(data):data;log(CONST.logName+" Loaded Feed for {type}: '"+type+"'"),vars._data[type]=normalized,vars._initExe[type]||(vars._initExe[type]=!0),triggerStack(vars._callStack[type],vars._data[type])}var feeds=vars._config.feeds,info=feeds[type]||!1;if(!info)return!1;var url=function(){var ret=!1;return"string"==typeof info?ret=info:info.url&&(ret=info.url),ret}();if(!url)return log(CONST.logName+" URL not defined for feed {type}: '"+type+"'"),!1;var dataType=function(){var ret="json",jsonpCallback=getJSONP(url);return"string"==typeof info.jsonpCallback||jsonpCallback?ret="jsonp":info.type&&inDataType(info.type)&&(ret=info.type),ret=ret.toLowerCase()}(),ajaxConfig={};switch(dataType){case"json":ajaxConfig={dataType:"json",cache:!0,async:!0,success:function(data){commonSuccessFN(data)}};break;case"jsonp":var urlCallback=getJSONP(url),callback=useJSONPCallback(type,"string"==typeof info.jsonpCallback&&info.jsonpCallback,urlCallback);window[callback.name]=function(data){commonSuccessFN(data)},ajaxConfig={dataType:"script",async:!0,cache:!0},urlCallback||(ajaxConfig.data={},ajaxConfig.data[callback.param]=callback.name)}if(ajaxConfig.url=url,function(){var cacheTime;"function"==typeof vars._config.cacheStrFN?(cacheTime=vars._config.cacheStrFN())&&(ajaxConfig.data||(ajaxConfig.data={}),ajaxConfig.data.cb=cacheTime):(cacheTime=!(!vars._config.cacheTime||isNaN(vars._config.cacheTime))&&parseFloat(vars._config.cacheTime))&&(ajaxConfig.data||(ajaxConfig.data={}),ajaxConfig.data.cb=cacheBuster(cacheTime))}(),"jsonp"!==dataType&&vars._xhr[type])try{"function"==typeof vars._xhr[type].abort&&vars._xhr[type].abort()}catch(err){}vars._xhr[type]=$.ajax(ajaxConfig)},triggerStack=function(stack,data){if(!isArray(stack))return!1;for(var x=0;x<stack.length;x++)"function"==typeof stack[x]&&stack[x](data)},setLoaderArgs=function(args){var type=!1,callbackFN=!1;return"string"==typeof args[0]?type=args[0]:"object"!=typeof args[0]||isArray(args[0])||(type=!!args[0].type&&args[0].type),"function"==typeof args[1]&&(callbackFN=args[1]),{type:type,callback:callbackFN}},getNormalizationFN=function(val,feeds){var i,ret=!1;if("function"==typeof val)ret=val;else if("string"==typeof val)for(i in feeds)if(val===i&&"function"==typeof feeds[i].normalize){ret=feeds[i].normalize;break}return ret},useJSONPCallback=function(type,opt1,opt2){var ret={param:"callback"};if(opt1&&2===opt1.split("=").length){var sp=opt1.split("=");ret.param=sp[0],ret.name=sp[1]}else ret.name=opt1||(opt2||"jsonp"+type);return ret},inDataType=function(type){var x,types=["jsonp","json","xml","html","text","script"];for(x=0;x<types.length;x++)if(types[x]===type.toLowerCase()){!0;break}},getJSONP=function(url){var x,ret=!1,sp=url.split("?"),search=sp[1];if(search){var arr=search.toLowerCase().indexOf(CONST.jsonpParam+"=")>-1?search.split("&"):[];for(x=0;x<arr.length;x++){var pair=arr[x].split("=");if(pair[0].toLowerCase()===CONST.jsonpParam){ret=decodeURI(pair[1]);break}}}return ret},log=function(){if(window.console)try{return console.log.apply(console,arguments)}catch(err){console.log(arguments)}},cacheBuster=function(freq){freq=freq||!1;var date=window.AKAMAI_TIME_HELPER&&"function"==typeof AKAMAI_TIME_HELPER.getCurrent?AKAMAI_TIME_HELPER.getCurrent():new Date,str=date.getFullYear().toString()+(date.getMonth()+1).toString()+date.getDate().toString(),hr=date.getHours()+1,min=date.getMinutes();return str+=hr.toString()+(freq&&!isNaN(freq)?Math.floor(min/parseFloat(freq)).toString():"")},isArray=function(val){return val=val||!1,"[object Array]"===Object.prototype.toString.call(val)},trimStr=function(val){return val=(val||"").replace(/^\s+|\s+$/g,"")};return App});