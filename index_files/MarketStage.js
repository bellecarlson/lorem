/*! updated; 02-27-2018 04:46 PM **/


Modulr.define("core.plugins:MarketStage",["jquery","AKAMAI_TIME_HELPER"],function($,AKAMAI_TIME_HELPER){var getCurrentTime=AKAMAI_TIME_HELPER.getCurrent,CONST={holidays:{2010:{1:"1|18",2:"15",4:"2",5:"31",7:"5",9:"6",11:"25",12:"24"},2011:{1:"1|17",2:"21",4:"22",5:"30",7:"4",9:"5",11:"24",12:"25"},2012:{1:"1|16",2:"20",4:"6",5:"28",7:"4",9:"3",11:"22",12:"25"},2013:{1:"1|21",2:"18",3:"29",5:"27",7:"4",9:"2",11:"28",12:"25"},2016:{1:"1|18",2:"15",3:"25",5:"30",7:"4",9:"5",11:"24",12:"25"},2017:{1:"2|16",2:"20",4:"14",5:"29",7:"4",9:"4",11:"23",12:"25"}}},Markets=function(){this._EVENTS={}};Markets.prototype={check:function(callback){var self=this,valid=!0;self.isClose(function(data){(data.isClose||self.isHoliday(data.current))&&(valid=!1),callback(valid)})},isHoliday:function(date){var x,holidays=CONST.holidays,found=!1,toStr=function(val){return val.toString()},mm=toStr(date.getMonth()+1),dd=toStr(date.getDate()),yr=toStr(date.getFullYear());if(holidays[yr]&&holidays[yr][mm]){var obj=holidays[yr][mm],days=obj.split("|");for(x=0;x<days.length;x++)if(days[x]===dd){found=!0;break}}return found},isClose:function(callback){var self=this;"function"==typeof callback&&callback(self.getInfo())},getStage:function(date_override){var self=this,info=self.getInfo(date_override),stage=null,description="";return info.isWeekend||info.isHoliday?(stage=0,description=info.isWeekend?"CLOSED: Weekend":"CLOSED: Holiday"):!info.isClose||info.isOpenBell||info.isAfterClose?info.isClose&&info.isOpenBell&&!info.isAfterClose?(stage=2,description="CLOSED: Opening Bell (30 minutes prior to Market Opening)"):info.isClose||info.isCloseBell?!info.isClose&&info.isCloseBell?(stage=4,description="OPEN: Closing Bell (30 minutes prior to Market Closing)"):info.isClose&&info.isAfterClose&&!info.afterMarketFutures?(stage=5,description="CLOSED. Market End"):info.isClose&&info.afterMarketFutures&&(stage=6,description=" CLOSED. Market Futures"):(stage=3,description="Market is OPEN"):(stage=1,description="CLOSED: Before Opening Bell"),{stage:stage,info:info,description:description}},getInfo:function(date_override){var self=this,isClose=!1,current=date_override||getCurrentTime(),day=current.getDay(),hr=current.getHours(),mins=current.getMinutes(),milTime=(current.getSeconds(),100*hr+mins);return self.isHoliday(current)?{isHoliday:!0,isClose:!0,current:current}:0===day||6===day?{isWeekend:!0,isClose:!0,current:current}:(isClose=!(milTime>=930&&milTime<1600),{isClose:isClose,current:current,isOpenBell:milTime>=900&&milTime<930,isCloseBell:milTime>=1530&&milTime<1600,isAfterClose:milTime>=1600&&milTime<1730,isAfterMarketFutures:milTime>=1730})},setEventListeners:function(id,events){var self=this;self._EVENTS[id]?log("[Markets.Info] Event Listener ID already exists: "+id):self._EVENTS[id]=new Events(events)}};var Events=function(){var Events=function(events){this.TIMER=window.FB_MARKET_INFO?window.FB_MARKET_INFO:new Markets,this._ValidEvents="onHolidayOrWeekend|onHoliday|onWeekend|onCloseBeforeOpenBell|onCloseDuringOpenBell|onOpen|onOpenDuringCloseBell|onCloseAfterMarket|",this._Events={},this._Triggered=[],this._intervalObj=!1,this._interval=3e3,this.set(events)};return Events.prototype={set:function(events){var i,self=this,valid=self._ValidEvents;for(i in events)valid.indexOf(i+"|")>-1&&"function"==typeof events[i]&&(self._Events[i]=events[i]);events=self._Events;var hasEventTriggered=function(val){return(self._Triggered.join("|")+"|").indexOf(val+"|")>-1},setEventTrigger=function(val){self._Triggered.push(val)},trigger=function(){var stageInfo=self.TIMER.getStage(),stage=stageInfo.stage,info=stageInfo.info;switch(stage){case 0:info.isHoliday&&events.onHoliday&&!hasEventTriggered("onHoliday")?(setEventTrigger("onHoliday"),events.onHoliday(stageInfo)):info.isWeekend&&events.onWeekend&&!hasEventTriggered("onWeekend")?(setEventTrigger("onWeekend"),events.onWeekend(stageInfo)):events.onHolidayOrWeekend&&!hasEventTriggered("onHolidayOrWeekend")&&(setEventTrigger("onHolidayOrWeekend"),events.onHolidayOrWeekend(stageInfo));break;case 1:events.onCloseBeforeOpenBell&&!hasEventTriggered("onCloseBeforeOpenBell")&&(setEventTrigger("onCloseBeforeOpenBell"),events.onCloseBeforeOpenBell(stageInfo));break;case 2:events.onCloseDuringOpenBell&&!hasEventTriggered("onCloseDuringOpenBell")&&(setEventTrigger("onCloseDuringOpenBell"),events.onCloseDuringOpenBell(stageInfo));break;case 3:events.onOpen&&!hasEventTriggered("onOpen")&&(setEventTrigger("onOpen"),events.onOpen(stageInfo));break;case 4:events.onOpenDuringCloseBell&&!hasEventTriggered("onOpenDuringCloseBell")&&(setEventTrigger("onOpenDuringCloseBell"),events.onOpenDuringCloseBell(stageInfo));break;case 5:events.onCloseAfterMarket&&!hasEventTriggered("onCloseAfterMarket")&&(setEventTrigger("onCloseAfterMarket"),events.onCloseAfterMarket(stageInfo))}};trigger(),self._intervalObj=setInterval(function(){trigger()},self._interval)},removeEvents:function(){var self=this;self._intervalObj&&clearInterval(self._intervalObj)}},Events}(),log=function(str){window.console&&console.log&&console.log(str)};return new Markets});