/*! updated; 02-27-2018 04:46 PM **/


Modulr.define("core.video:api",["require","jquery","lodash","helper","@fnc/embed/main","models/embeds","models/autoadvance","models/get.video","models/ais.auth","akamai.ver"],function(require,$,_,Helper){var VideoEmbed=require("@fnc/embed/main"),PageEmbeds=require("models/embeds"),AutoAdvance=require("models/autoadvance"),GetVideoFeed=require("models/get.video"),AISAuth=require("models/ais.auth"),AKAMAI_VERSION=require("akamai.ver"),PLAYLIST_STACK={},App=function(){};return App.prototype.embed=function(target,opts){if(0===target.length)return Helper.log("Error: called video embed, no target!"),null;if(1!==target.length)return Helper.log("Error: multiple targets, loop through each one"),null;opts=_.isObject(opts)?_.cloneDeep(opts):{};var Instance=new VideoEmbed(target,opts);return Instance.set(),AutoAdvance(Instance),Instance},App.prototype.provider=function(type,target,opts,callback){require(["views/"+type+"/main"],function(App){new App(target,opts).set(callback)})},App.prototype.__iframe=function(type,opts,callback){require(["@fnc/iframe/main"],function(App){new App(type,opts).set(callback)})},App.prototype.getInfo=function(){return{build:"v"+AKAMAI_VERSION,embeds:PageEmbeds.getInfo()}},App.prototype.getQueryVar=function(val){return Helper.getQueryVar(val)},App.prototype.getVideoFeedById=function(){GetVideoFeed.apply(GetVideoFeed,arguments)},App.prototype.getPlaylistFeed=function(playlistId){function normalize(data){var obj={};obj.raw=data;var channel=data.channel,item=channel.item;return item=Array.isArray(item)?item:[item],obj.items=item,obj}var args=arguments,domain=null,callback=null;if("object"==typeof args[1]?(domain=args[1].domain||null,args[2]&&"function"==typeof args[2]&&(callback=args[2])):"function"==typeof args[1]&&(callback=args[1]),!(!playlistId||!callback)){if(PLAYLIST_STACK[playlistId])return void callback(PLAYLIST_STACK[playlistId]);var url=Helper.getPlaylistFeedUrl(playlistId,{domain:domain||null});$.ajax({url:url,dataType:"jsonp",jsonpCallback:"uid_"+playlistId}).done(function(data){var norm=normalize(data);PLAYLIST_STACK[playlistId]=norm,callback(norm)})}},App.prototype.translateConfig=function(legacy,conds){var config=_.cloneDeep(legacy);conds=conds||{};var res={};return res.app={videoId:config.app.videoId,domain:config.app.domain,rules:function(){var arr=[];return config.player.autoplay&&!conds.playNext&&arr.push("autoplay"),config.player.autoadvance&&config.player.autoadvance.enabled&&arr.push("autoAdvance"),config.player.params&&config.player.params.playerName&&arr.push("playername:"+config.player.params.playerName),arr}()},res.player=config.player,res},App.prototype.isAISAuthenticated=function(callback){"function"==typeof callback&&AISAuth.init(callback)},new App});
Modulr.define("core.video:config",["require","jquery","cdn","akamai.ver"],function(require,$){var AKAMAI_BUNDLE_VERSION=require("akamai.ver"),IS_SSL=!!/https/.test(window.location.protocol),config={};return config.cdn=require("cdn"),config.akamai={secure:IS_SSL,version:AKAMAI_BUNDLE_VERSION,feed:"/v/feed/video/${videoId}.js?template=fox",bundlePattern:"//foxnewsplayer-a.akamaihd.net/${envFolder}/${version}/amp.premier",configParam:{site:{foxnews:"fn",foxbusiness:"fb","live.foxbusiness":"fblive",insider:"insider",nation:"nation",radio:"radio"}}},config.videoDomain=["foxnews","foxbusiness","insider.foxnews"],config.optsDefault={player:{autoplay:!1,autoadvance:{enabled:!1,interval:5},ais:{redir:window.location.href},flash:{params:{wmode:"opaque"},vars:{share_enabled_providers:"facebook,twitter,linkedin"}}}},config.fncRadioId="5599024308001",config.eventPrefix="core.video.events",config.tve={foxnews:{videoId:"5614615980001",resourceID:"FoxNews"},foxbusiness:{videoId:"5614626175001",resourceID:"FoxBusiness"}},config.authenticated={foxnews:{resourceID:"FoxNews"},foxbusiness:{resourceID:"FoxBusiness"}},config.autoadvance={feed:"//${domain}/feeds/web/trending/video/all/feed/json"},config.ais={platformId:"urn:foxnews:com:sp:"+("qa"===config.cdn.env?"staging":"site")+":2"},config});
Modulr.define("core.video:helper",["require","jquery","akamai.time","config","core.base:utils/script.loader","core.plugins:URLInfo","jquery.cookie"],function(require,$,time,config){var loadScript=require("core.base:utils/script.loader"),URLInfo=require("core.plugins:URLInfo"),cdn=config.cdn,Helper=function(){};return Helper.prototype.getCurrentTime=function(){return time.getCurrent()},Helper.prototype.getEnv=function(){return cdn.env},Helper.prototype.getDomainId=function(){var hostname=window.location.hostname;return/foxbusiness\.com/.test(hostname)?"foxbusiness":/insider\.foxnews\.com/.test(hostname)?"insider.foxnews":"foxnews"},Helper.prototype.validateVideoId=function(id){return!/[^0-9]/g.test(id)},Helper.prototype.setEventName=function(name){return[config.eventPrefix,name].join("_")},Helper.prototype.loadScript=function(src,callback){if(src="string"==typeof src?[src]:src,$.isArray(src)){var trigger=function(){src.length>0?loadScript(src.shift(),function(){trigger()}):"function"==typeof callback&&callback()};trigger()}},Helper.prototype.enc=function(val){return encodeURIComponent(val)},Helper.prototype.dec=function(val){return decodeURIComponent(val)},Helper.prototype.log=function(){if(window.console){var args=Array.prototype.slice.call(arguments);args.unshift("[core.video]");try{return window.console.log.apply(window.console,args)}catch(err){window.console.log(args.join(" | "))}}},Helper.prototype.getQueryVar=function(name){var url=new URLInfo(window.location.href).getInfo(),res=url.query[name]||url.hash[name]||null;return null!==res&&"boolean"==typeof res&&(res=res.toString()),res},Helper.prototype.setUrlQuery=function(url,props){var item=new URLInfo(url),info=item.getInfo();for(var id in props){var val=props[id];info.query[id]?info.query[id]=val:info.hash[id]=val}return info},Helper.prototype.reEmbedIframe=function(instance,newOpts){var self=this,res=!1,currVideoId=instance._opts.app.videoId,currDomain=instance._opts.app.domain,isLegacy=instance._opts.app.legacy||!1,isTVE=self.isTVEVideoId(currVideoId),newIsTVE=self.isTVEVideoId(newOpts.app.videoId),newDomain=newOpts.app.domain||"foxnews";return isLegacy?res=!0:currVideoId!==config.fncRadioId&&newOpts.app.videoId===config.fncRadioId?res=!0:currVideoId===config.fncRadioId&&newOpts.app.videoId!==config.fncRadioId?res=!0:currDomain!==newDomain?res=!0:isTVE&&!newIsTVE||!isTVE&&newIsTVE?res=!0:isTVE&&newIsTVE&&currVideoId!==newOpts.app.videoId&&(res=!0),res},Helper.prototype.generateBundlePaths=function(ver,env,opts){var self=this,isTVE=opts.app.tve||!1,envFolder=(opts.app.auth,"prod"===env&&"qa"===config.cdn.env?"player":"qa"===config.cdn.env?"player/test":"player"),path=config.akamai.bundlePattern.replace("${version}",ver).replace("${envFolder}",envFolder),res={path:path,script:path+"/amp.premier"+("qa"===config.cdn.env?"":".min")+".js",conf:path+"/amp.foxnews.central.json?sec="+(config.akamai.secure?"1":"0")},queryParams=[];return function(){var site;if(isTVE){var domainId=(opts.app.videoId,config.tve.foxbusiness.videoId,opts.app.videoId===config.tve.foxbusiness.videoId?"live.foxbusiness":"foxnews");site=config.akamai.configParam.site[domainId]}else site=opts.app.ampConfig&&opts.app.ampConfig.site?opts.app.ampConfig.site:config.videoDomain.indexOf(opts.app.domain)>-1?config.akamai.configParam.site[opts.app.domain]:config.akamai.configParam.site[self.getDomainId()];queryParams.push("site="+site)}(),function(){var params="notitle";opts.app.ampConfig&&"string"==typeof opts.app.ampConfig.params&&(params=[params,opts.app.ampConfig.params].join(",")),params=_.uniq(params.split(",")).join(","),queryParams.push("param="+params)}(),function(){opts.app.ampConfig&&opts.app.ampConfig.namespace&&queryParams.push("ns="+opts.app.ampConfig.namespace)}(),queryParams.length>0&&(res.conf=res.conf+"&"+queryParams.join("&")),res},Helper.prototype.cacheBuster=function(interval){isNaN(interval)?(interval=Math.floor(parseInt(interval,10)),interval=interval<2?2:interval>59?60:interval):interval=2;var c=this.getCurrentTime(),mins=c.getMinutes(),ret=[c.getFullYear(),c.getMonth()+1,c.getDate(),c.getHours()].join("");return ret+=Math.floor(mins/interval)},Helper.prototype.setResponseTarget=function(resourceID,prefix){prefix=prefix||"live";var redirect="FoxBusiness"===resourceID?"_fb":"_fn";redirect=prefix+redirect;var popup="FoxBusiness"===resourceID?"_fb_winpopup":"_fn_winpopup";return popup=prefix+popup,{redirect:redirect,popup:popup}},Helper.prototype.isTVEVideoId=function(id){var res=!1;for(var i in config.tve)if(config.tve[i].videoId===id){res=!0;break}return res},Helper.prototype.setAISCookie=function(opts){var val=opts&&opts.player&&opts.player.ais&&"string"==typeof opts.player.ais.redir?opts.player.ais.redir:null,expires=val?1:-1,cookieDomain=function(){var sp=window.location.hostname.split(".");return"."+sp.slice(sp.length-2).join(".")}();$.cookie("FXN_v_idpp",val,{path:"/",domain:cookieDomain,expires:expires})},Helper.prototype.getHeight=function(width){return 9*Math.round(width/16)},Helper.prototype.getArticleBody=function(){var el=$("article div[itemprop='articleBody']");return 0===el.length&&(el=$("article .article-body")),el},Helper.prototype.getVideoFeedUrl=function(videoId,conf){return"//"+function(domain){var res="video.foxnews.com";return domain&&/foxbusiness/i.test(domain)&&(res="video.foxbusiness.com"),"prod"!==cdn.env&&(res="beta."+res),res}(conf&&conf.domain?conf.domain:null)+"/v/feed/video/"+videoId+".json?template=fox"},Helper.prototype.getPlaylistFeedUrl=function(playlistId,conf){return"//"+function(domain){var res="video.foxnews.com";return domain&&/foxbusiness/i.test(domain)&&(res="video.foxbusiness.com"),"prod"!==cdn.env&&(res="beta."+res),res}(conf&&conf.domain?conf.domain:null)+"/v/feed/playlist/"+playlistId+".json?template=fox"},new Helper});
Modulr.define("core.video:main",["require","jquery"],function(require,$){});
Modulr.define("core.video:models/ais.auth",["require","jquery","lodash","helper","config"],function(require,$,_,Helper,config){function request(){var url="//idp.securetve.com/rest/1.0/"+config.ais.platformId+"/init/?format=jsonp&responsefield=fxn_ais_idpInit";window.fxn_ais_idpInit=function(response){processStack(response),delete window.fxn_ais_idpInit,EXECUTING=!1},$.ajax({url:url,dataType:"script",cache:!0,error:function(jqXHR,textStatus,errorThrown){console.log("aisRequest > ERROR:",jqXHR,textStatus,errorThrown),processStack(null)}})}function processStack(data){for(var i=0;i<CALLBACK_STACK.length;i++)CALLBACK_STACK[i](data)}var EXECUTING=!1,CALLBACK_STACK=[],App=function(){};return App.prototype.init=function(callback){CALLBACK_STACK.push(callback),EXECUTING||(EXECUTING=!0,request())},new App});
Modulr.define("core.video:models/autoadvance",["require","jquery","lodash","helper","config"],function(require,$,_,Helper,config){function loadPlaylist(url,callback){REQUEST_STACK[url]?REQUEST_STACK[url].done?callback(REQUEST_STACK[url].data):REQUEST_STACK[url].fn.push(callback):(REQUEST_STACK[url]={data:null,fn:[callback],done:!1},$.ajax({url:url,dataType:"jsonp",jsonpCallback:"fxtartlist",cache:!0,success:function(data){var items=processData(data);REQUEST_STACK[url].data=items,REQUEST_STACK[url].done=!0,triggerStack(url)}}))}function triggerStack(url){if(REQUEST_STACK[url])for(var data=REQUEST_STACK[url].data;REQUEST_STACK[url].fn.length>0;){var fn=REQUEST_STACK[url].fn.shift();fn(data)}}function processData(data){var arr=[];if(data&&data.response&&data.response.docs)for(var items=data.response.docs,i=0;i<items.length;i++){var item=items[i],url=!!(item.url&&Array.isArray(item.url)&&item.url[0])&&item.url[0];if(url){var videoId=function(){var ret=null,sp=url.split("/v/")[1]||!1,v=!!sp&&sp.split("/")[0];return v&&!isNaN(v)&&(ret=v),ret}();videoId&&arr.push(videoId)}}return arr}var REQUEST_STACK={};return function(Instance){var opts=Instance.getOpts();if(!!(opts&&opts.player&&opts.player.autoadvance&&opts.player.autoadvance.enabled)&&(!opts.app.autoadvance||!(!opts.app.autoadvance||"custom"===opts.app.autoadvance))){var url=config.autoadvance.feed.replace("${domain}",["www",opts&&opts.player&&/foxbusiness/i.test(opts.player.domain)?"foxbusiness":"foxnews","com"].join(".")),index=0;loadPlaylist(url,function(items){Instance.on("amp.advance",function(){var nextVideoId=items[index]||null;Helper.log("playing next video id:",nextVideoId),nextVideoId&&(Instance.change(nextVideoId,{player:{autoplay:!0}}),index++)})})}}});
Modulr.define("core.video:models/embeds",["require","jquery","lodash","helper","config"],function(require,$,_,Helper,config){function stopOtherPlayers(uid){for(var id in VIDEO_EMBED){var item=VIDEO_EMBED[id];id!==uid&&item.instance&&(item.instance.pause(),item._playing=!1)}}function validateUID(uid){return!!/^fnc-embed-([0-9]+)/.test(uid)}var VIDEO_EMBED_ITER=0,VIDEO_EMBED={},LAST_PLAY_UID=null,App=function(){};return App.prototype.generateUID=function(){return"fnc-embed-"+ ++VIDEO_EMBED_ITER},App.prototype.initialize=function(uid,type){validateUID(uid)?VIDEO_EMBED[uid]||(VIDEO_EMBED[uid]={_initialized:!0,instance:null}):Helper.log("warning: invalid uid: "+uid)},App.prototype.store=function(uid,type,instance){validateUID(uid)?VIDEO_EMBED[uid].instance=instance:Helper.log("warning: invalid uid: "+uid)},App.prototype.setPlayState=function(uid,isPlaying){null===LAST_PLAY_UID?(LAST_PLAY_UID=uid,VIDEO_EMBED[uid]._playing=isPlaying,stopOtherPlayers(uid)):isPlaying?LAST_PLAY_UID!==uid&&(LAST_PLAY_UID=uid,VIDEO_EMBED[uid]._playing=!0,stopOtherPlayers(uid)):VIDEO_EMBED[uid]._playing=!1},App.prototype.getInfo=function(){var info={};for(var uid in VIDEO_EMBED)if(VIDEO_EMBED[uid].instance){var item=VIDEO_EMBED[uid].instance;info[uid]={target:item._target.get(0)}}return info},new App});
Modulr.define("core.video:models/get.video",["require","jquery","lodash","helper","config"],function(require,$,_,Helper,config){var FEED_STACK={};return function(){function executeStack(videoId){if(FEED_STACK[videoId].stack.length>0)for(;FEED_STACK[videoId].stack.length>0;){var fn=FEED_STACK[videoId].stack.shift();fn(FEED_STACK[videoId].data)}}function normalize(data){var obj={};obj.raw=data;var channel=data.channel,item=channel.item;return obj.image=item["media-group"]["media-thumbnail"]["@attributes"],obj.requires_auth=function(restrict,status){var res=!1;return restrict&&"string"==typeof restrict&&"urn:protected"===restrict?res=!0:restrict&&"object"==typeof restrict&&restrict["@attributes"]?"deny"!==restrict["@attributes"].relationship&&"urn:protected"!==restrict["#text"]||(res=!0):status&&status["@attributes"]&&"blocked"===status["@attributes"].state&&(res=!0),res}(item["media-restriction"],item["media-status"]),obj.norm={},item["dc-date"]&&(obj.norm["dc-date"]=setVideoDateTime(item["dc-date"])),obj}function setVideoDateTime(val){var sp=val.split("T"),date=sp[0],time=sp[1].split("-")[0];return date=date.split("-"),date=[date[1],date[2],date[0]].join("/"),new Date([date,time].join(" "))}var args=arguments,domain=null,callback=null,videoId=args[0];if("object"==typeof args[1]?(domain=args[1].domain||null,args[2]&&"function"==typeof args[2]&&(callback=args[2])):"function"==typeof args[1]&&(callback=args[1]),!(!videoId||!callback))if(FEED_STACK[videoId])FEED_STACK[videoId].data?callback(FEED_STACK[videoId].data):FEED_STACK[videoId].stack.push(callback);else{FEED_STACK[videoId]={data:null,stack:[callback]};var url=Helper.getVideoFeedUrl(videoId,{domain:domain||null});$.ajax({url:url,dataType:"jsonp",jsonpCallback:"uid_"+videoId,cache:!0}).done(function(data){var norm=normalize(data);FEED_STACK[videoId].data=norm,executeStack(videoId)})}}});
Modulr.define("core.video:models/is.authenticated",["require","jquery","lodash","helper","config","core.base:utils/localStorage","models/get.video"],function(require,$,_,Helper,config){function getStore(){var res=null,val=LocalStorage.get(storeId);if(val){var curr=JSON.parse(val);hasExpired(curr.expires)||curr.list.length<50&&(res=curr)}return res}function setStore(val,isAuth){void 0!==val&&LocalStorage.set(storeId,function(){val=""+val;var curr=getStore();return curr?(-1===curr.list.indexOf(val)&&curr.list.push(val),isAuth&&curr.auth.push(val)):curr={list:[val],auth:isAuth?[val]:[],expires:function(){return Helper.getCurrentTime().getTime()+60*expiry*60*1e3}()},JSON.stringify(curr)}())}function hasExpired(time){return Helper.getCurrentTime().getTime()>parseInt(time,10)}var LocalStorage=require("core.base:utils/localStorage"),GetVideoFeed=require("models/get.video"),storeId="videoIsAuth",expiry=24;return new function(){this.check=function(videoId,domain,callback){function cont(bool){setStore(videoId,bool),callback(bool,!1)}if(Helper.isTVEVideoId(videoId))callback(!0,!0);else{var curr=getStore()||{};if(curr.list&&curr.list.indexOf(""+videoId)>-1)return callback(!!(curr.auth&&curr.auth.indexOf(""+videoId)>-1));GetVideoFeed(videoId,{domain:domain},function(data){cont(data.requires_auth)})}}}});
Modulr.define("core.video:models/new.relic",["require","jquery","lodash","helper","config","ISA","akamai.ver"],function(require,$,_,Helper,config,ISA){var Provider=ISA.provider("new-relic"),CoreTracker=ISA.provider("coreTracker"),ENV=Helper.getEnv(),AKAMAI_BUNDLE_VERSION=require("akamai.ver");return function(VIDEO_ID){var Proto=this,VIDEO_DOMAIN=/foxbusiness/.test(window.location.host)?"foxbusiness":"foxnews",AD_BLOCK_STATUS=CoreTracker.isEnabled(),BUILD_VERSION=Modulr.getGlobalCacheParam();Proto.set=function(){Provider.setCustomAttributes({"fnc.video.iframe.AD_BLOCK":AD_BLOCK_STATUS,"fnc.video.iframe.ENV":ENV,"fnc.video.iframe.VIDEO_DOMAIN":VIDEO_DOMAIN,"fnc.video.iframe.VIDEO_ID":VIDEO_ID,"fnc.video.iframe.FRONTEND_BUILD_VERSION":BUILD_VERSION,"fnc.video.iframe.AMP_VERSION":AKAMAI_BUNDLE_VERSION}),"function"==typeof window.newrelic.setErrorHandler&&(window.newrelic.setErrorHandler(function(err){return Provider.setCustomPageAction({JSErrorEvent:{"fnc.video.iframe.error.ERR_TYPE":err.name,"fnc.video.iframe.error.ERR_MESSAGE":err.message,"fnc.video.iframe.error.STACK_TRACE":err.stack,"fnc.video.iframe.error.AD_BLOCK_STATUS":AD_BLOCK_STATUS,"fnc.video.iframe.error.PLAYER_VERSION:":version,"fnc.video.iframe.error.FRONTEND_BUILD_VERSION":BUILD_VERSION}}),!1}),Helper.log("NR listener ready!"))}}});
Modulr.define("core.video:models/overlay",["require","jquery","lodash","helper","config","models/get.video","core.plugins:ImageResizer"],function(require,$,_,Helper,config){var GetVideoFeed=require("models/get.video"),Resizer=require("core.plugins:ImageResizer");return function(target,videoId,domain){this.set=function(trigger){GetVideoFeed(videoId,{domain:domain},function(data){var src=data&&data.image&&data.image.url?data.image.url:null;if(src){var markup='<div class="m video-ct">                            <a href="#"><picture>                            <source media="(max-width: 767px)" srcset="'+Resizer(src,348,196)+'">                            <source media="(min-width: 768px)" srcset="'+Resizer(src,768,432)+'">                            <img src="'+src+'" alt="image name">                        </picture>                        <span class="overlay">Video</span></a>                        </div>';target.html(markup),target.find("a").on("click",function(evt){return evt.preventDefault(),trigger(),!1})}else trigger();console.log("data",data)}),console.log("todo: //"),trigger()}}});
Modulr.define("core.video:views/fox-news/embed/events",["require","jquery","lodash","helper","config"],function(require,$,_,Helper,config){var App=function(uid,IframeListener){this._UID=uid,this._IframeListener=IframeListener;var EVENT_STACK={};this._listenFor=function(name,callback){EVENT_STACK[name]||(EVENT_STACK[name]=[]),EVENT_STACK[name].push(callback)},this._IframeListener.listen(function(event){var name=event.name,data=event.data;if(EVENT_STACK[name])for(var i=0;i<EVENT_STACK[name].length;i++)EVENT_STACK[name][i](data)}),this._listenFor("amp.auth.reloadParentPage",function(){window.location.reload()})};return App.prototype.play=function(callback){var event=this._IframeListener;this._listenFor("amp.play",function(){"function"==typeof callback&&callback()}),event.send("play")},App.prototype.pause=function(callback){var event=this._IframeListener;"function"==typeof callback&&this._listenFor("amp.pause",callback),event.send("pause")},App.prototype.pauseState=function(callback){var event=this._IframeListener;"function"==typeof callback&&this._listenFor("player.pauseState",callback),event.send("pauseState")},App.prototype.mute=function(callback){var event=this._IframeListener;"function"==typeof callback&&this._listenFor("player.mute",callback),event.send("mute")},App.prototype.unmute=function(callback){var event=this._IframeListener;"function"==typeof callback&&this._listenFor("player.unmute",callback),event.send("unmute")},App.prototype.volume=function(callback){var event=this._IframeListener;"function"==typeof callback&&this._listenFor("player.volume",callback),event.send("volume")},App.prototype.volumeSet=function(callback,val){if("number"!=typeof val)callback(null);else{var event=this._IframeListener;"function"==typeof callback&&this._listenFor("player.volume.set",callback),event.send("volumeSet",{val:val})}},App.prototype.muteState=function(callback){var event=this._IframeListener;"function"==typeof callback&&this._listenFor("player.muteState",callback),event.send("muteState")},App.prototype.jump=function(callback,val){var event=this._IframeListener;"function"==typeof callback&&this._listenFor("player.jump",callback),event.send("jump",val)},App.prototype.logout=function(callback){this._IframeListener.send("logout")},App});
Modulr.define("core.video:views/fox-news/embed/isa",["require","jquery","lodash","helper","config","ISA"],function(require,$,_,Helper,config,ISA){return function(mainCallback){if("function"==typeof mainCallback){var omtrInterface=(window.FNC.ISA.provider("omni"),window.FNC.ISA.provider("krux"),function(provider){var success=!1;return function(callback){provider?(provider.onExtInterfaceReady(function(omtrVals){success||(success=!0,callback(omtrVals))}),setTimeout(function(){success||(success=!0,Helper.log("warning: omniture did not return after 5 seconds!"),callback(null))},5e3)):callback()}}(window.FNC.ISA.provider("omni"))),kruxInterface=function(provider){var success=!1;return function(callback){provider?(provider.get(function(){success||(success=!0,callback({ksg:provider.getVal("segments"),kuid:provider.getVal("user")}))}),setTimeout(function(){success||(success=!0,Helper.log("[video.renderer] warning: krux did not return after 5 seconds!"),callback(null))},5e3)):callback()}}(window.FNC.ISA.provider("krux"));omtrInterface(function(omtrVals){kruxInterface(function(kruxVals){mainCallback({omtr:omtrVals,krux:kruxVals})})})}}});
Modulr.define("core.video:views/fox-news/embed/main",["require","jquery","helper","config","models/embeds","models/is.authenticated","models/overlay","@fnc/embed/events","@fnc/embed/isa","@fnc/rules","@fnc/listener","ISA","cache.param"],function(require,$,Helper,config){function validate(target,opts,attr){var res=!0,errors=[];return 0===target.length?(res=!1,errors.push("target not found")):attr.videoId||opts.app.videoId||(errors.push("missing videoId"),res=!1),{valid:res,errors:errors}}function getAttr(target){var videoId=target.attr(VIDEO_UID_ATTR)||null,domain=target.attr(VIDEO_DOMAIN_ATTR)||Helper.getDomainId();return videoId=Helper.validateVideoId(videoId)?videoId:null,domain=-1===config.videoDomain.indexOf(domain)?null:domain,{videoId:videoId,domain:domain}}function changeVideo(self,videoId,newOpts){function reEmbed(){Helper.log("[embed] re-embedding iframe..");var currOpts=_.cloneDeep(self._opts);if(config.fncRadioId===videoId?Rules.set("fncRadio",newOpts):newOpts.app.domain||(newOpts.app.domain="foxnews"),!_.isEmpty(currOpts.app.ampConfig)){_.isEmpty(newOpts.app.ampConfig)&&(newOpts.app.ampConfig={site:config.akamai.configParam.site[newOpts.app.domain]||null});for(var id in currOpts.app.ampConfig)newOpts.app.ampConfig[id]||(newOpts.app.ampConfig=currOpts.ampConfig)}currOpts.app.domain!==newOpts.app.domain&&self._target.attr(VIDEO_DOMAIN_ATTR,newOpts.app.domain),self._opts.player={},self._opts.app.omtrVals={},_.merge(self._opts,newOpts),Rules.setApp(self._opts),self._PLAYER_READY=!1,self._INITIALIZED=!1,self.set()}self._target.attr(VIDEO_UID_ATTR,videoId);var attr=getAttr(self._target);Helper.reEmbedIframe(self,newOpts)?reEmbed():IsAuthenticated.check(videoId,newOpts.app.domain||attr.domain||null,function(bool){bool?reEmbed():self._IframeListener.send("__change",{videoId:videoId,opts:newOpts})})}function share(data){require(["core.plugins:Sharing"],function(Sharing){switch(data.provider){case"facebook":Sharing.facebook(data.url);break;case"twitter":Sharing.twitter({url:data.url,title:data.title});break;case"embed":break;case"email":var params=[];params.push("subject="+Helper.enc(data.title)),params.push("body=Video link:"+Helper.enc(data.url)),window.open("mailto:?"+params.join("&"),"_self")}})}var EventListener=require("@fnc/listener"),Events=require("@fnc/embed/events"),ISAInterface=require("@fnc/embed/isa"),Rules=require("@fnc/rules"),PageEmbed=require("models/embeds"),CacheParam=require("cache.param"),Overlay=require("models/overlay"),IsAuthenticated=require("models/is.authenticated"),ENV=Helper.getEnv(),ISA=require("ISA"),VIDEO_UID_ATTR="data-video-id",VIDEO_DOMAIN_ATTR="data-video-domain",CHANGE_STACK_ID="__change",App=function(target,opts){this._UID=PageEmbed.generateUID(),this._target=target||[],this._opts=function(uid){var res=_.cloneDeep(config.optsDefault);return res=_.merge(res,_.cloneDeep(opts)),res=_.merge(res,{app:{uid:uid}})}(this._UID),Rules.setApp(this._opts),this._PLAYER_READY=!1,this._INITIALIZED=!1,this._IframeListener=EventListener.create(this._target,this._UID,"embed"),this._Events=new Events(this._UID,this._IframeListener),this._EVENT_STACK={},this._LISTENER_INIT=!1,PageEmbed.initialize(this._UID,"fox-news"),this.__getOpts=function(){return this._opts}};return App.prototype.on=function(event,callback){"string"==typeof event&&"function"==typeof callback&&(this._EVENT_STACK[event]||(this._EVENT_STACK[event]=[]),this._EVENT_STACK[event].push(callback))},App.prototype.trigger=function(){function exec(){self._Events[event](callback,props)}var self=this,args=arguments,event=args[0],props=null,callback=null;"function"==typeof args[1]?callback=args[1]:("function"!=typeof args[1]&&(props=args[1]),"function"==typeof args[2]&&(callback=args[2])),self._Events[event]&&(self.isReady()?exec():self.on("player.ready",function(){exec()}))},App.prototype.isReady=function(){return!!this._PLAYER_READY},App.prototype.getOpts=function(){return this.__getOpts()},App.prototype.pause=function(){this.trigger("pause")},App.prototype.play=function(){this.trigger("play")},App.prototype.change=function(videoId,newOpts){if(!Helper.validateVideoId(videoId))return void Helper.log("[change] invalid videoId:",videoId);videoId!==this._target.attr(VIDEO_UID_ATTR)&&(newOpts=function(){var res=_.cloneDeep(config.optsDefault);return _.isObject(newOpts)&&_.merge(res,newOpts),res}(),_.merge(newOpts,{app:{videoId:videoId}}),this._PLAYER_READY?changeVideo(this,videoId,newOpts):this._EVENT_STACK[CHANGE_STACK_ID]={videoId:videoId,opts:newOpts})},App.prototype.set=function(callback){function cont(IS_PROTECTED,IS_TVE){IS_PROTECTED&&(IS_TVE&&_.merge(opts,{app:{tve:!0}}),_.merge(opts,{app:{auth:{enabled:!0,domain:VIDEO_DOMAIN}}}),Rules.set("setAIS",opts)),target.attr(function(){var obj={};return obj["data-embed-uid"]=EMBED_UID,obj[VIDEO_UID_ATTR]=VIDEO_ID,obj}());var trigger=function(){var markup='<iframe src="${src}" border="0" frameborder="0" scrolling="no" style="width: 100%; height: 100%;" mozallowfullscreen webkitallowfullscreen allowfullscreen></iframe>',sub="qa"===ENV?"beta.":"",videoType=IS_PROTECTED?"tve":"vod",src="//"+sub+["video",VIDEO_DOMAIN,"com"].join(".")+"/static/orion/html/video/iframe/"+videoType+".html?v="+CacheParam,params=function(){var arr=[];return arr.push("uid="+Helper.enc(EMBED_UID)),arr.join("&")}();if(_.merge(opts,{app:{videoId:VIDEO_ID,domain:VIDEO_DOMAIN}}),window.AamGpt&&"function"==typeof window.AamGpt.getCookie){var aam=AamGpt.getCookie("fngpt")||!1;aam&&(aam=aam.split("="),aam=aam.length>1?aam[1]:aam[0],_.merge(opts,{player:{params:{aam:aam}}}));var aamId=AamGpt.getCookie("aam_did")||!1;aamId&&(aamId=aamId.split("="),aamId=aamId.length>1?aamId[1]:aamId[0],_.merge(opts,{player:{params:{aamId:aamId}}}))}self._LISTENER_INIT||(self._LISTENER_INIT=!0,IframeListener.listen(function(event){var name=event.name,data=event.data;switch(name){case"iframe.ready":IframeListener.send("__load",self.__getOpts());break;case"player.ready.init":if(self._PLAYER_READY=!0,self._opts=_.merge(self._opts,data.opts),"function"==typeof callback&&callback(self),PageEmbed.store(EMBED_UID,"fox-news",self),self._EVENT_STACK[CHANGE_STACK_ID]){var change=self._EVENT_STACK[CHANGE_STACK_ID];changeVideo(self,change.videoId,change.opts)}break;case"amp.play":case"amp.ads.started":case"amp.ads.play":PageEmbed.setPlayState(EMBED_UID,!0);break;case"amp.pause":PageEmbed.setPlayState(EMBED_UID,!1);break;case"amp.sharepanel.share":opts.app.noShare||share(data)}if("player.ready.init"===name&&(name="player.ready",data={videoId:VIDEO_ID,uid:EMBED_UID,domain:opts.app.domain,bundleVersion:data.bundleVersion}),self._EVENT_STACK[name])for(var i=0;i<self._EVENT_STACK[name].length;i++)self._EVENT_STACK[name][i](data)})),markup=markup.replace("${src}",[src,params].join("#")),function(){var triggerFrame=function(vals){vals=vals||{},vals.omtr&&_.merge(opts,{app:{omtrVals:vals.omtr}}),vals.krux&&_.merge(opts,{app:{kruxVals:vals.krux}}),target.empty(),target.html(markup)};ISA?ISAInterface(function(info){triggerFrame(info)}):triggerFrame(null)}()};!function(){if(opts.app.overlay&&opts.app.overlay.enabled){var item=_.cloneDeep(opts.app.overlay);if(Rules.set("autoplay",opts),"function"==typeof item.event){item.event(function(){trigger()});try{delete opts.app.overlay.event}catch(err){opts.app.overlay.event=null}}else new Overlay(target,VIDEO_ID,VIDEO_DOMAIN).set(function(){trigger()})}else trigger()}()}if(!this._INITIALIZED){this._INITIALIZED=!0;var self=this,IframeListener=this._IframeListener,attr=getAttr(this._target),validation=validate(this._target,this._opts,attr);if(callback="function"==typeof callback?callback:function(){},!validation.valid)return void callback(validation,null);var target=this._target,opts=this._opts,EMBED_UID=this._UID,VIDEO_ID=opts.app.videoId||attr.videoId,VIDEO_DOMAIN=opts.app.domain||attr.domain;IsAuthenticated.check(VIDEO_ID,VIDEO_DOMAIN,function(bool,IS_TVE){cont(bool,IS_TVE)})}},App});
Modulr.define("core.video:views/fox-news/embed/migrate",["require","jquery","lodash","helper","config"],function(require,$,_,Helper,config){return function(Instance,opts,legacy){return legacy=_.cloneDeep(legacy),opts}});
Modulr.define("core.video:views/fox-news/embed/uid",["require","jquery","lodash","helper","config"],function(require,$,_,Helper,config){var VIDEO_EMBED_ITER=0;return function(){return"fox-video-embed-"+ ++VIDEO_EMBED_ITER}});
Modulr.define("core.video:views/fox-news/iframe/amp.events",["require","jquery","helper","config","core.plugins:OnWindowResize","core.plugins:EventMessageHandler"],function(require,$,Helper,config,akamai){function showShareEmbedOverlay(info){var body=$("body"),embed=body.find("> .share-panel.embed");0===embed.length&&($("body").prepend('<div class="share-panel embed">                <h1>Embed</h1>                <a href="#" title="Close">Close</a>                <textarea>Embed code inserted here</textarea>            </div>'),embed=body.find("> .share-panel.embed"),embed.find("textarea").unbind("focus").bind("focus",function(){var elm=$(this);elm.select(),elm.bind("mouseup",function(){return elm.unbind("mouseup"),!1})}),embed.find("> a:first").unbind("click").bind("click",function(evt){return evt.preventDefault(),embed.removeClass("show"),!1}),_overlay_center||(_overlay_center=!0,centerOverlay(embed,!0)));var textarea=embed.find("textarea"),domain=/foxbusiness\.com/.test(window.location.hostname)?"video.foxbusiness.com":"video.foxnews.com",siteLink=domain.indexOf("video.foxbusiness")>-1?"foxbusiness.com":"foxnews.com",protocol=window.location.protocol,videoId=info.videoId,code='<script type="text/javascript" src="'+protocol+"//"+domain+"/v/embed.js?id="+videoId+'&w=466&h=263"><\/script><noscript>Watch the latest video at <a href="'+protocol+"//www."+siteLink+'">'+siteLink+"</a></noscript>";textarea.val(code),embed.addClass("show")}function centerOverlay(target,force){var listener=!1,body=$("body"),win=$(window),overlayW=target.outerWidth(),overlayH=target.outerHeight(),px=function(val){return val+"px"},topScroll=function(){var w=win.height(),s=win.scrollTop(),h=overlayH;return h=Math.floor(w/2-h/2),s+(h<0?0:h)},leftScroll=function(){var l=body.offset().left,w=body.width();return w=Math.floor(w/2-overlayW/2),l+w},trigger=function(){clearTimeout(listener),listener=setTimeout(function(){target.animate({top:px(topScroll()),left:leftScroll()},150,"swing")},150)};force&&target.css({top:px(topScroll()),left:leftScroll()});window;OnWindowResize(function(){trigger()})}var OnWindowResize=require("core.plugins:OnWindowResize"),EventHandler=require("core.plugins:EventMessageHandler"),FrameEvents=new EventHandler,App=function(amp,EventListener,opts,callback){function sendVideoInfo(type,data){send("info.change",{data:{type:type,info:data},opts:opts})}var send=function(name,data){EventListener.send(name,("object"==typeof data?data.data||data:data)||!0)};if(opts.player&&opts.player.getPlaybackOrder){opts.player.getPlaybackOrder=null;try{delete opts.player.getPlaybackOrder}catch(err){}}if(amp.ads&&(amp.ads.addEventListener("companion",function(data){send("amp.ads.companion",{data:{companions:!!(data&&data.data&&data.data.companions)&&data.data.companions}})}),amp.ads.addEventListener("started",function(data){send("amp.ads.started",data)}),amp.ads.addEventListener("ended",function(data){send("amp.ads.ended",data)}),amp.ads.addEventListener("error",function(){amp.evaluateBindings("#{window.createShowPersonality(media.category)}"),amp.evaluateBindings("#{window.createShowCategory(media.category)}"),amp.evaluateBindings("#{window.createShowName(media.category)}"),amp.evaluateBindings("#{window.createShowSection(media.category)}"),Helper.log("[amp.ads.error] An error has been generated:",arguments)}),amp.ads.addEventListener("play",function(data){send("amp.ads.play",data)}),amp.ads.addEventListener("pause",function(data){send("amp.ads.pause",data)})),amp.auth&&function(){var RELOAD_TRIGGERED=!1,authHandler=function(name,event){if(!event)return Helper.log("No authentication event data!"),!1;var isAuthorization=!(!event||!event.data||"boolean"!=typeof event.data.authorization),authConfig=!!(event&&event.target&&event.target.config)&&event.target.config,authData={resource:authConfig.resourceID,platform_id:authConfig.platformID};isAuthorization&&(authData.authorization=event.data.authorization);var info={name:name,data:{type:isAuthorization?"authorization":"authentication",data:event.data,auth:authData}};Helper.log("Authentication Handler:",name,info),send("amp.auth.handler",info)};amp.auth.addEventListener("authorizationfailed",function(data){authHandler("authorizationfailed",data)}),amp.auth.addEventListener("authenticated",function(data){authHandler("authenticated",data)}),amp.auth.addEventListener("launchidplogin",function(data){Helper.setAISCookie(opts),$(window).bind("beforeunload",function(){RELOAD_TRIGGERED||(RELOAD_TRIGGERED=!0)})})}(),amp.autoadvance&&amp.autoadvance.addEventListener("advance",function(data){send("amp.advance",data)}),amp.recommendations&&amp.recommendations.addEventListener("selected",function(data){send("amp.recommendations",data)}),"function"==typeof window.enableLiveAds){var oncanplaythrough=function(){amp.removeEventListener("canplaythrough",oncanplaythrough),enableLiveAds(amp)};amp.addEventListener("canplaythrough",oncanplaythrough)}if(amp.addEventListener("mediachange",function(data){send("amp.mediachange",{amp:data.data,opts:opts}),sendVideoInfo("mediachange",data.data)}),amp.addEventListener("play",function(data){send("amp.play",{amp:data.data,opts:opts})}),amp.addEventListener("ended",function(data){send("amp.ended",{amp:data.data,opts:opts})}),amp.addEventListener("pause",function(data){send("amp.pause",{amp:data.data,opts:opts})}),amp.sharepanel){var feedData=!1;amp.sharepanel.addEventListener("share",function(data){var shareData=data.data||data;feedData=feedData||amp.feed.getData();var customShareURL=Helper.getQueryVar("shareUrl")||!1,customShareTitle=Helper.getQueryVar("shareTitle")||!1,url=customShareURL||shareData.link.replace(/beta\./,""),title=function(){var res="";if(customShareTitle){res=$("<span></span>").html(customShareTitle).text()}else feedData.channel&&feedData.channel.item&&feedData.channel.item.title&&(res=feedData.channel.item.title);return res}(),info={videoId:feedData.channel&&feedData.channel.item&&feedData.channel.item.guid?feedData.channel.item.guid:null,provider:shareData.provider,url:url,title:title};"share"!==shareData.provider&&("embed"===shareData.provider?showShareEmbedOverlay(info):send("amp.sharepanel.share",info))})}amp.feed&&amp.feed.addEventListener("loaded",function(data){send("amp.feed.loaded",{feed:data.data,opts:opts}),sendVideoInfo("feed.loaded",data.data)}),function(name,callback){FrameEvents.addHandler(name,function(){callback.apply(callback,arguments)})}("ais-popup.page-reload",function(){send("amp.auth.reloadParentPage")})},_overlay_center=!1;return App});
Modulr.define("core.video:views/fox-news/iframe/amp.functions",["require","jquery","helper","config"],function(require,$,Helper,config){function createCategoryString(categories,tag){var items=[];categories=categories||[];for(var i=0;i<categories.length;i++){var item=categories[i];if(startsWith(item,tag)){var cat=item.replace(tag,"");cat=cat.split("/")[0],-1===$.inArray(cat,items)&&items.push(cat);break}}return items.join(",")}function startsWith(str,val){var ret=!1;if($.isArray(val)){for(var i=0;i<val.length;i++)if(0===str.indexOf(val[i])){ret=!0;break}}else"string"==typeof str&&(ret=0===str.indexOf(val));return ret}window.getAdParams_SDMax=function(media){var sdmax=0,query="",AMPMedia=!(!amp||!amp.feed||"function"!=typeof amp.feed.getData)&&amp.feed.getData(),AMPDuration=function(m){return!(!(m&&m.channel&&m.channel.item&&m.channel.item["media-group"]&&m.channel.item["media-group"]["media-content"]&&m.channel.item["media-group"]["media-content"][0]&&m.channel.item["media-group"]["media-content"][0]["@attributes"])||isNaN(m.channel.item["media-group"]["media-content"][0]["@attributes"].duration))&&m.channel.item["media-group"]["media-content"][0]["@attributes"].duration}(AMPMedia),duration="boolean"!=typeof AMPDuration?AMPDuration:!(!media||!media.duration)&&media.duration;return duration=isNaN(duration)?-1:parseFloat(duration),-1===duration?sdmax=90:duration<=45?sdmax=45:duration>45&&duration<=180?sdmax=60:duration>180&&duration<=600&&(sdmax=90),sdmax&&(query=1e3*sdmax),query},window.getAdParams_SZ=function(media){var sz=["1001x1001"];return window.akamai&&window.akamai.amp&&window.akamai.amp.utils&&window.akamai.amp.utils.Utils&&"flash"===window.akamai.amp.utils.Utils.getPlaybackMode()&&sz.push("1920x1080"),sz.join("|")},window.isLive=function(categories){for(var ret="false",cat=categories||[],x=0;x<cat.length;x++)if(cat[x].indexOf("live_stream")>-1){ret="true";break}return ret},window.createShowCategory=function(category){for(var modified=[],i=0;i<category.length;i++){var item=category[i];startsWith(item,"special")||startsWith(item,"settings")||-1!==$.inArray(item,modified)||modified.push(item)}return modified.join(",")},window.createShowName=function(category){var ret=createCategoryString(category,"on_air/");return"personality"===ret&&(ret=""),ret},window.createShowPersonality=function(category){var ret=createCategoryString(category,"personality/");return ret||(ret=createCategoryString(category,"on_air/personality/")),ret},window.createShowSection=function(category){var val=function(){for(var ret=!1,i=0;i<category.length;i++){var item=category[i];if(0===item.indexOf("primary_")){ret=item.replace("primary_","");break}}return ret}();return val?"partner_content"!==val&&"personality"!==val||(val="null"):val=function(){var ret="",common=["full_episode","hot_topics","on_air","partner_content","personality","promotion","settings","special","web_exclusives","3play_processed"],foxnews=["cleartv","business","latino","mobile","odd_news"],foxbiz=["events","exclusive","government","politics"];foxnews=foxnews.concat(common),foxbiz=foxbiz.concat(common);for(var i=0;i<category.length;i++){var item=category[i];if(/foxnews/.test(window.location.hostname)&&!startsWith(item,foxnews)){ret=item.split("/")[0];break}if(/foxbusiness/.test(window.location.hostname)&&!startsWith(item,foxbiz)){ret=item.split("/")[0];break}val||(ret="false")}return ret}(),val},window.AEP={jsCallbackHandler:function(id,type,data){}}});
Modulr.define("core.video:views/fox-news/iframe/default.rules",["require","jquery","helper","config","@fnc/rules"],function(require,$,Helper,config){var Rules=require("@fnc/rules");return function(opts){opts.app.tve?Rules.set("playername",opts,"qa"===config.cdn.env?"beta_tve":"tve"):Rules.set("playername",opts,Helper.getQueryVar("pn")||opts.player.name),/html/.test(opts.player.mode)&&Rules.set("moat",opts),Rules.set("embedUrl",opts),opts.app.omtrVals||Rules.set("noHeartbeat",opts),opts.app.videoId===config.fncRadioId&&Rules.set("fncRadio",opts),opts.app.tve&&Rules.set("noShare",opts)}});
Modulr.define("core.video:views/fox-news/iframe/events",["require","jquery","helper","config","models/is.authenticated","@fnc/iframe/default.rules","@fnc/iframe/amp.events","core.plugins:LoadAttempt"],function(require,$,Helper,config,akamai){var DefaultRules=require("@fnc/iframe/default.rules"),attempt=(require("models/is.authenticated"),function(callback,success){require("core.plugins:LoadAttempt")(150,150,callback,success,function(){Helper.log("warning: failed event attempt!"),Helper.log(callback)})}),AMP_EVENTS=require("@fnc/iframe/amp.events"),Events=function(EventListener){this._EventListener=EventListener,this._PLAYER_INSTANCE=null,this._opts=null,this._READY_FOR_EVENTS=!1};return Events.prototype.play=function(){var amp=this._PLAYER_INSTANCE,ready=(this._EventListener,this._READY_FOR_EVENTS);attempt(function(){return!(!ready||!amp||"function"!=typeof amp.play)},function(){setTimeout(function(){amp.play()},150)})},Events.prototype.pause=function(){var amp=this._PLAYER_INSTANCE,ready=(this._EventListener,this._READY_FOR_EVENTS);attempt(function(){return!(!ready||!amp||"function"!=typeof amp.pause)},function(){amp.pause()})},Events.prototype.pauseState=function(callback){var amp=this._PLAYER_INSTANCE,event=this._EventListener,ready=this._READY_FOR_EVENTS;attempt(function(){return!(!ready||!amp||"function"!=typeof amp.getPaused)},function(){var bool=amp.getPaused();event.send("player.pauseState",bool),"function"==typeof callback&&callback(bool)})},Events.prototype.mute=function(){var amp=this._PLAYER_INSTANCE,event=this._EventListener,ready=this._READY_FOR_EVENTS;attempt(function(){return!(!ready||!amp||"function"!=typeof amp.mute)},function(){amp.mute(),event.send("player.mute",{volume:amp.getVolume()})})},Events.prototype.unmute=function(){var amp=this._PLAYER_INSTANCE,event=this._EventListener,ready=this._READY_FOR_EVENTS;attempt(function(){return!(!ready||!amp||"function"!=typeof amp.unmute)},function(){amp.unmute(),event.send("player.unmute",{volume:amp.getVolume()})})},Events.prototype.volume=function(){var amp=this._PLAYER_INSTANCE,event=this._EventListener,ready=this._READY_FOR_EVENTS;attempt(function(){return!(!ready||!amp||"function"!=typeof amp.getVolume)},function(){event.send("player.volume",{volume:amp.getVolume()})})},Events.prototype.volumeSet=function(info){var amp=this._PLAYER_INSTANCE,event=this._EventListener,ready=this._READY_FOR_EVENTS;attempt(function(){return!(!ready||!amp||"function"!=typeof amp.setVolume||"function"!=typeof amp.getVolume)},function(){amp.setVolume(info.val),event.send("player.volume.set",{volume:amp.getVolume()})})},Events.prototype.muteState=function(){var amp=this._PLAYER_INSTANCE,event=this._EventListener,ready=this._READY_FOR_EVENTS;attempt(function(){return!(!ready||!amp||"function"!=typeof amp.getMuted)},function(){event.send("player.muteState",{state:amp.getMuted()})})},Events.prototype.jump=function(data){function trigger(){var curr=amp.getCurrentTime();isNaN(curr)?iter<100&&(iter++,setTimeout(function(){trigger()},50)):(amp.setCurrentTime(data),event.send("player.jump",!0))}var amp=this._PLAYER_INSTANCE,event=this._EventListener,ready=this._READY_FOR_EVENTS;if("number"!=typeof data)return!1;var iter=0;attempt(function(){return!(!ready||!amp||"function"!=typeof amp.setCurrentTime)},function(){trigger()})},Events.prototype.logout=function(){var amp=this._PLAYER_INSTANCE,ready=(this._EventListener,this._READY_FOR_EVENTS),opts=this._opts;opts.app.auth&&opts.app.auth.enabled&&attempt(function(){return!!(ready&&amp&&amp.auth&&"function"==typeof amp.auth.logout)},function(){Helper.setAISCookie(opts),amp.auth.logout()})},Events.prototype.__change=function(data){var amp=this._PLAYER_INSTANCE,ready=(this._EventListener,this._READY_FOR_EVENTS),self=this,urlInfo=Helper.setUrlQuery(window.location.href,{id:data.videoId}),newHash=function(){var res=[];for(var id in urlInfo.hash)res.push([id,urlInfo.hash[id]].join("="));return res="#"+res.join("&")}();window.location.hash=newHash,attempt(function(){return!!(ready&&amp&&amp.feed&&"function"==typeof amp.feed.setData)},function(){var url=config.akamai.feed.replace("${videoId}",data.videoId);$.ajax({url:url,dataType:"jsonp",data:{cb:Helper.cacheBuster(5)},cache:!0,async:!0}).done(function(data){amp.feed.setData(data),self.play()})})},Events.prototype.__load=function(opts){var self=this,EventListener=this._EventListener;this._videoId=opts.app.videoId;var loadPlayer=function(){var feedurl=(opts.app.tve?window.location.protocol+"//video.foxnews.com":"")+config.akamai.feed.replace("${videoId}",self._videoId);_.merge(opts,{player:{feed:{url:feedurl}}});var bundlePath=function(){var ver=opts.app.bundleVersion||config.akamai.version,env="qa"===config.cdn.dev&&"prod"===opts.app.bundleEnv?"prod":null;return Helper.generateBundlePaths(ver,env,opts)}();DefaultRules(opts),Helper.loadScript([bundlePath.script],function(){attempt(function(){return!!(window.akamai&&window.akamai.amp&&window.akamai.amp.AMP)},function(){window.akamai.amp.AMP.loadDefaults(bundlePath.conf,function(){function handler(){AMP_EVENTS(self._PLAYER_INSTANCE,EventListener,opts),EventListener.send("player.ready.init",{opts:opts,bundleVersion:opts.app.bundleVersion||config.akamai.version}),self._READY_FOR_EVENTS=!0}var videoConf=_.cloneDeep(opts.player);Helper.log("video config:",videoConf),window.amp=window.akamai.amp.AMP.create("player",videoConf,handler),self._PLAYER_INSTANCE=window.amp})})})};if(window.s_account=opts.app.omtrVals?opts.app.omtrVals.s_account:"foxnews",window.omtr)try{delete window.omtr}catch(err){window.omtr=null}if(opts.app.kruxVals&&(Helper.log("Krux values passed:",opts.app.kruxVals),_.merge(opts.player.params,{ksg:opts.app.kruxVals.ksg,kuid:opts.app.kruxVals.kuid})),opts.app.omtrVals&&-1===opts.app.rules.indexOf("noAds")){var shims=[];-1===opts.app.rules.indexOf("noTracking")&&shims.push("adobe.visitor"),shims.push("isa.omniture"),require(shims,function(){_.merge(window.omtr,opts.app.omtrVals.merged),Helper.log("Omniture omtr variable in video iframe:",window.omtr),loadPlayer()})}else loadPlayer()},function(){var API=function(EventListener){this._EventListener=EventListener,this._Events=new Events(EventListener)};return API.prototype.trigger=function(event,data){this._Events[event]&&this._Events[event](data)},API.prototype.setOpts=function(opts){this._Events._opts=opts},API}()});
Modulr.define("core.video:views/fox-news/iframe/main",["require","jquery","helper","config","@fnc/listener","@fnc/iframe/amp.functions","akamai.time","models/new.relic"],function(require,$,Helper,config){var AkamaiTime=require("akamai.time"),EventListener=require("@fnc/listener"),NewRelic=require("models/new.relic"),ALL_PLAYER_DEFAULTS={mode:"html-auto",name:"embed",flash:{vars:{live_timestamp_timezone_offset:AkamaiTime.isDST().val?"-4":"-5"}},params:{adparamSDMAX:"#{window.getAdParams_SDMax(media)}",adparamSZ:"#{window.getAdParams_SZ(media)}",paramIsLive:"#{window.isLive(media.category)}",section:"#{window.createShowSection(media.category)}",eVar32:"#{window.createShowName(media.category)}",prop32:"#{window.createShowName(media.category)}",eVar33:"#{window.createShowCategory(media.category)}",prop33:"#{window.createShowCategory(media.category)}",eVar34:"#{window.createShowPersonality(media.category)}",prop34:"#{window.createShowPersonality(media.category)}"},autoadvance:{enabled:!1},mediaanalytics:{dimensions:{device:"#{player.mode}"}},rules:{PDL_LOW:{label:"Android 4 or Kindle Fire HD avoid HLS and get PDL_MED_LOW",regexp:"Android 4"}}},App=function(type,opts){this._type=type,this._opts="object"==typeof opts?opts:{},_.merge(this._opts,{player:_.cloneDeep(ALL_PLAYER_DEFAULTS)}),this._UID=Helper.getQueryVar("uid")||"self",this._EventListener=EventListener.create("parent",this._UID,"iframe")};return App.prototype.set=function(callback){var self=this,opts=this._opts;new NewRelic(this._UID).set(),require(["@fnc/iframe/"+this._type],function(View){new View(opts,self._EventListener,callback)})},App});
Modulr.define("core.video:views/fox-news/iframe/tve",["require","jquery","helper","config","@fnc/iframe/events"],function(require,$,Helper,config){var Events=require("@fnc/iframe/events"),PLAYER_DEFAULTS={autoplay:!1,getPlaybackOrder:function(order){if(/Edge|Android|Safari/.test(navigator.userAgent))return["hls","dash","dvr","default","audio"]}};return function(opts,EventListener,callback){var self=this;this._opts=_.merge({player:_.cloneDeep(PLAYER_DEFAULTS)},_.cloneDeep(opts)),this._Events=new Events(EventListener),EventListener.listen(function(event){var name=event.name,data=event.data;"__load"===name?(_.merge(self._opts,data),self._Events.setOpts(self._opts),self._Events.trigger(name,_.cloneDeep(self._opts)),"function"==typeof callback&&callback(_.cloneDeep(self._opts))):self._Events.trigger(name,data)}),EventListener.send("iframe.ready")}});
Modulr.define("core.video:views/fox-news/iframe/vod",["require","jquery","helper","config","@fnc/iframe/events","@fnc/rules"],function(require,$,Helper,config){var Events=require("@fnc/iframe/events"),PLAYER_DEFAULTS=(require("@fnc/rules"),{autoplay:!1});return function(opts,EventListener,callback){var self=this;this._opts=_.merge({player:_.cloneDeep(PLAYER_DEFAULTS)},_.cloneDeep(opts)),this._queryVideoId=null,this._Events=new Events(EventListener),this._queryVideoId||(EventListener.listen(function(event){var name=event.name,data=event.data;"__load"===name?(_.merge(self._opts,data),self._Events.setOpts(self._opts),self._Events.trigger(name,_.cloneDeep(self._opts)),"function"==typeof callback&&callback(_.cloneDeep(self._opts))):self._Events.trigger(name,data)}),EventListener.send("iframe.ready"))}});
Modulr.define("core.video:views/fox-news/listener",["require","jquery","lodash","helper","config","core.plugins:EventMessageHandler"],function(require,$,_,Helper,config){function setName(name){return Helper.setEventName("event.listener.")}var Handler=require("core.plugins:EventMessageHandler"),App=function(target,uid,type){this._UID=uid,this._target=target,this._type=type||"generic",this._Handler=new Handler,this._LISTENER_STACK=[];var self=this,messageId=setName("event.receiver.")+this._UID;this._Handler.addHandler(messageId,function(data){for(var i=0;i<self._LISTENER_STACK.length;i++)self._LISTENER_STACK[i](data)})};App.prototype.listen=function(callback){if("function"==typeof callback){setName("event.receiver."),this._UID;this._LISTENER_STACK.push(callback)}},App.prototype.send=function(name,data){if(name){var obj={uid:"uid-embed-"+this._UID,name:name,data:void 0===data?null:data},messageId=setName("event.sender.")+this._UID,target="parent"===this._target?"parent":this._target.find("> iframe:first").get(0);this._Handler.sendMessage(target,messageId,obj)}};var API=function(){this._EVENTS_STACK={}};return API.prototype.create=function(target,uid,type){return uid&&target?(type=type||null,this._EVENTS_STACK[uid]||(this._EVENTS_STACK[uid]=new App(target,uid,type)),this._EVENTS_STACK[uid]):null},API.prototype.get=function(uid){return this._EVENTS_STACK[uid]||null},new API});
Modulr.define("core.video:views/fox-news/rules",["require","jquery","lodash","helper","config"],function(require,$,_,Helper,config){var App=function(){};App.prototype.autoplay=function(opts){_.merge(opts.player,{autoplay:!0,usersettings:{enabled:!1},flash:{vars:{user_controlled_autoplay:!0,auto_play_override:!0}}})},App.prototype.autostart=function(opts){_.merge(opts.player,{autoplay:!0,flash:{vars:{user_controlled_autoplay:!0,auto_play_override:!0}}})},App.prototype.noAutoplay=function(opts,props){_.merge(opts.player,{autoplay:!1,usersettings:{enabled:!1},flash:{vars:{user_controlled_autoplay:!0}}})},App.prototype.noAds=function(opts,props){_.merge(opts.player,{ima:{enabled:!1},flash:{vars:{core_ads_enabled:!1}}})},App.prototype.noTracking=function(opts,props){_.merge(opts.player,{nielsen:{enabled:!1},chartbeatanalytics:{enabled:!1},chartbeat:{enabled:!1},comscore:{enabled:!1},comscorestreamsense:{enabled:!1},omniture:{enabled:!1,useJS:!1,heartbeat:{enabled:!1}}})},App.prototype.playername=function(opts,props){var name=props||opts.player.name||"inpage";_.merge(opts.player,{name:name,params:{playerName:name},mediaanalytics:{fields:{pageName:{type:"value",value:name}}},flash:{vars:{core_player_name:name,core_ad_player_name:name,core_omniture_player_name:name}}})},App.prototype.moat=function(opts,props){(!opts.app.rules||(!opts.app.rules||!/(noAds|noTracking)/.test(opts.app.rules.join("|"))))&&_.merge(opts.player,{moat:{data:{partnerCode:"foxima87313513"}}})},App.prototype.embedUrl=function(opts,props){if(!opts.player.params.parentEmbedUrl)try{if(window.location!==window.parent.location){var url=document.referrer;_.merge(opts.player,{params:{parentEmbedUrl:url}})}}catch(err){}},App.prototype.noHls=function(opts,props){_.merge(opts.player,{hls:{enabled:!1}})},App.prototype.noHlsCredentials=function(opts,props){_.merge(opts.player,{hls:{withCredentials:!1}})},App.prototype.heartbeat=function(opts,props){_.merge(opts.player,{omniture:{useJS:!1,heartbeat:{enabled:!0,liveLinear:{enabled:!0}}}})},App.prototype.noHeartbeat=function(opts,props){_.merge(opts.player,{omniture:{useJS:!1,heartbeat:{enabled:!1}}})},App.prototype.fncRadio=function(opts,props){_.merge(opts.app,{domain:"foxnews",ampConfig:{site:config.akamai.configParam.site.radio}}),_.merge(opts.player,{hls:{withCredentials:!1},omniture:{useJS:!1,heartbeat:{enabled:!0,liveLinear:{enabled:!0}}}})},App.prototype.foxnews=function(opts,props){_.merge(opts.app,{domain:"foxnews",ampConfig:{site:config.akamai.configParam.site.foxnews}})},App.prototype.foxbusiness=function(opts,props){_.merge(opts.app,{domain:"foxbusiness",ampConfig:{site:config.akamai.configParam.site.foxbusiness}})},App.prototype.fncInsider=function(opts,props){_.merge(opts.app,{domain:"video.insider",ampConfig:{site:config.akamai.configParam.site.insider}})},App.prototype.fncNation=function(opts,props){_.merge(opts.app,{domain:"foxnews",ampConfig:{site:config.akamai.configParam.site.nation}})},App.prototype.fbnLive=function(opts,props){_.merge(opts.app,{domain:"foxbusiness",ampConfig:{site:config.akamai.configParam.site["live.foxbusiness"]}})},App.prototype.noShare=function(opts,props){_.merge(opts.player,{sharepanel:{enabled:!1},flash:{vars:{share_mode:"2",show_sharing_overlay:"false",show_email_overlay:"false"}}})},App.prototype.setAIS=function(opts,props){var platformID=config.ais.platformId,prefix=props&&props.prefix?props.prefix:null,resourceID=function(){var res;return opts.app.tve?res=opts.app.videoId===config.tve.foxbusiness.videoId?config.tve.foxbusiness.resourceID:config.tve.foxnews.resourceID:opts.app.auth&&(res=(opts.app.auth.domain?config.authenticated[opts.app.auth.domain]:config.authenticated.foxnews).resourceID),res}();_.merge(opts.player,{aisPrefix:"video",ais:{platformID:platformID,resourceID:resourceID,contentID:"#{media.guid}",responseTargets:Helper.setResponseTarget(resourceID,prefix),logos:{base:window.location.protocol+"//global.fncstatic.com/static/p/watch/img/logo/chooser/",group:"top_providers",key:"filename"}},flash:{vars:{core_omniture_account:"foxnewsmaven"}}}),opts.player.omniture||_.merge(opts.player,{omniture:{useJS:!1,heartbeat:{enabled:!0,liveLinear:{enabled:!0}}}}),props&&props.redir&&this.authRedir(opts,props.redir),this.noShare(opts)},App.prototype.authRedir=function(opts,props){"string"==typeof props&&_.merge(opts.player,{ais:{redir:props}})},App.prototype.noTitleBar=function(opts,props){_.merge(opts.player,{titlebar:{enabled:!1}})},App.prototype.noKrux=function(opts,props){_.merge(opts.player,{plugins:{krux:{enabled:!1}}})},App.prototype.autoAdvance=function(opts,props){_.merge(opts.player,{autoadvance:{enabled:!0}})};var rules=new App;return function(){var API=function(){};return API.prototype.set=function(id,opts,props){rules[id]&&rules[id](opts,props)},API.prototype.setApp=function(opts){if($.isArray(opts.app.rules))for(var i=0;i<opts.app.rules.length;i++){var item=opts.app.rules[i],index=item.indexOf(":"),id=item,props=null;index>-1&&(id=item.slice(0,index),props=item.slice(index+1)),rules[id]&&rules[id](opts,props)}},new API}()});
Modulr.define("core.video:views/vimeo/main",["require","jquery","helper","config","ISA","models/embeds","core.plugins:OnWindowResize"],function(require,$,Helper,config,ISA){function getVideoId(elem,p){return elem.find(".video-vimeo").attr("video-id")}var PageEmbed=require("models/embeds"),ARTICLE_BODY=Helper.getArticleBody(),OnWindowResize=require("core.plugins:OnWindowResize"),App=function(target,opts){this._target=target,this._opts=opts||{},this._videoId=getVideoId(target),this._UID=PageEmbed.generateUID(),PageEmbed.initialize(this._UID,"vimeo")};return App.prototype.set=function(id,target){this.setLegacy(this._target,this._videoId)},App.prototype.setLegacy=function(target,videoId){target.each(function(){var elm=$(this),id=videoId||!1;if(!id)return!1;var iframe,body=ARTICLE_BODY,width=body.width(),height=Helper.getHeight(width);elm.html('<iframe src="//player.vimeo.com/video/'+id+'" width="'+width+'px" height="'+height+'px" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>'),iframe=elm.find("> iframe:first"),OnWindowResize(function(){var w=body.width(),h=Helper.getHeight(w);iframe.css({width:w,height:h})},50)})},App.prototype.pause=function(){},App});
Modulr.define("core.video:views/youtube/main",["require","jquery","helper","config","ISA","models/embeds","@fnc/listener","core.plugins:OnWindowResize"],function(require,$,Helper,config,ISA){function getVideoId(elem,p){return elem.find(".video-youtube").attr("video-id")}var PageEmbed=require("models/embeds"),ARTICLE_BODY=Helper.getArticleBody(),OnWindowResize=require("core.plugins:OnWindowResize"),App=function(target,opts){this._target=target,this._opts=opts||{},this._videoId=getVideoId(target),this._INITIALIZED=!1,this._UID=PageEmbed.generateUID(),PageEmbed.initialize(this._UID,"youtube")};return App.prototype.set=function(id,target){this.setLegacy(this._target,this._videoId)},App.prototype.setLegacy=function(target,videoId){target.each(function(){var elm=$(this),id=videoId||!1;if(!id)return!1;var iframe,body=ARTICLE_BODY,width=body.width(),height=Helper.getHeight(width);elm.html('<iframe src="//www.youtube.com/embed/'+id+'?version=3&enablejsapi=1" frameborder="0" style="width:'+width+"px; height:"+height+'px;"></iframe>'),iframe=elm.find("> iframe:first"),OnWindowResize(function(){var w=body.width(),h=Helper.getHeight(w);iframe.css({width:w,height:h})},50)})},App});
!function(Modulr,FNC){if(Modulr.getInstance("core.video"))return!1;var config={instance:"core.video",baseDomain:FNC.CDN.domain,baseUrl:"/static/orion/scripts/core/video/app",masterFile:"/static/orion/scripts/core/utils/modulr/master.js",paths:{"@fnc":"views/fox-news","@youtube":"views/youtube","@vimeo":"views/vimeo"},packages:["core.plugins","core.base"],shim:{jquery:{src:"/static/orion/scripts/core/utils/jquery/core.js",exports:"jQuery"},"jquery.cookie":{src:"/static/orion/scripts/core/utils/jquery/plugins/cookie.js",exports:"jQuery.cookie"},lodash:{src:"/static/orion/scripts/core/utils/lodash.js",exports:"_"},"akamai.time":{src:"//global.fncstatic.com/static/v/all/js/geo.js",exports:"AKAMAI_TIME_HELPER"},"isa.omniture":{src:"/static/isa/app/lib/omtr_code.js",exports:"omtr"},"adobe.visitor":{src:"/static/isa/app/lib/VisitorAPI.js",exports:"Visitor"}}},Instance=Modulr.config(config);Instance.define("cdn",function(){return FNC.CDN}),Instance.define("akamai.ver",function(){return"7.90.9"}),Instance.define("ISA",function(){return FNC.ISA||null}),Instance.define("cache.param",["core.base:utils/environment"],function(Env){return Env.getCacheParam()}),window.FNC.core.video=window.FNC.core.video||function(){var App=function(){this._app=null};return App.prototype.getInfo=function(){if(this._app)return this._app.getInfo()},App.prototype.load=function(callback){if("function"==typeof callback){var self=this;self._app?callback(app):Instance.require(["api"],function(app){self._app=app,callback(app)})}},App.prototype.getHelper=function(callback){"function"==typeof callback&&Instance.require(["helper"],function(Helper){callback(Helper)})},new App}()}(window.Modulr,window.FNC);