/*! updated; 02-27-2018 04:46 PM **/


Modulr.define("core.plugins:MarketFutures",["require","jquery","STATIC_DOMAIN","MarketStage","EventMessageHandler"],function(require,$,DOMAIN){var MarketStage=require("MarketStage"),Event=new(require("EventMessageHandler"));return new function(){function triggerStack(){requestData(function(data){for(;READY_STACK.length>0;){READY_STACK.shift()(data)}})}function requestData(callback){var id=getCallbackId();return CALLBACK_DUMP[id]=function(data){callback(data),setTimeout(function(){try{delete CALLBACK_DUMP[id]}catch(err){CALLBACK_DUMP[id]=null}},500)},sendMessage("futures.get",{id:id}),id}function getCallbackId(){return CALLBACK_ITER++,["cb",CALLBACK_ITER].join("_")}function loadFrame(){FRAME_LOADED=!0;var src=DOMAIN+"/static/v/all/html/markets/futures/frame.html";0===$("#"+FRAME_ID).length&&$("body").append('<iframe id="'+FRAME_ID+'" src="'+src+'"></iframe>')}function sendMessage(event,data){data=data||null,Event.sendMessage(FRAME,event,data)}var Proto=this,FRAME_READY=!1,FRAME_LOADED=!1,READY_STACK=[],CALLBACK_DUMP={},CALLBACK_ITER=0,FRAME=null,FRAME_ID="ifr-mktfutures";Proto.isFutures=function(){var stage=MarketStage.getStage().stage;return 1===stage||2===stage},Proto.getData=function(callback){"function"==typeof callback&&(FRAME_LOADED||loadFrame(),FRAME_READY?requestData(callback):READY_STACK.push(callback))},Event.addHandler("futures.ready",function(){FRAME_READY=!0,FRAME=$("#"+FRAME_ID).get(0),READY_STACK.length>0&&triggerStack()}),Event.addHandler("futures.data",function(info){CALLBACK_DUMP[info.id]&&CALLBACK_DUMP[info.id](info.data)})}});